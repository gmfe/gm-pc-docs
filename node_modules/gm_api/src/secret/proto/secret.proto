syntax = "proto3";

package ceres.secret;

option go_package = "code.guanmai.cn/back_end/ceres/secret/proto;proto";
import "./include/protoc-gen-validate/validate.proto";
import "./google/api/annotations.proto";

service SecretService {
    // 用于获取七牛云上传文件的 token。一个 token 可以上传多个文件，但是要注意两点：
    // 1. 不要超过过期时间
    // 2. 只能在 response 中的 dir_path 中上传文件
    rpc GetQiniuUploadToken(GetQiniuUploadTokenRequest) returns (GetQiniuUploadTokenResponse) {
        option (google.api.http) = {
            post : "/ceres/secret/SecretService/GetQiniuUploadToken"
        };
    }
}

// FileType 表示文件类型，命名格式为 "FILE_TYPE" + 模块名 + 类型
enum FileType {
    FILE_TYPE_UNSPECIFIED = 0;

    FILE_TYPE_MERCHANDISE_CATEGORY_DEFAULT_IMAGE = 10; // 系统自带的分类图片
    FILE_TYPE_MERCHANDISE_CATEGORY_IMAGE         = 11; // 用户上传的分类图片
    FILE_TYPE_MERCHANDISE_SKU_IMAGE              = 12; // 用户上传的SKU图片
    FILE_TYPE_MERCHANDISE_SSU_IMAGE              = 13; // 用户上传的SSU图片

    FILE_TYPE_ENTERPRISE_LOGO = 20; // 企业 LOGO 图片
}

message GetQiniuUploadTokenRequest {
    FileType file_type = 1 [ (validate.rules).message = {required: true} ];
}
message GetQiniuUploadTokenResponse {
    string upload_token = 1 [ (validate.rules).string = {min_len : 1} ];
    string dir_path     = 2 [ (validate.rules).string = {min_len : 1} ]; // 文件上传的目录路径，比如 "foo/bar/baz/"
    uint64 expire_time  = 3 [ (validate.rules).uint64 = {gt : 1} ];      // token 在多长时间后会过期，单位是毫秒。客户端需要注意网络传输本身就会带来一些时间的损耗。
}
